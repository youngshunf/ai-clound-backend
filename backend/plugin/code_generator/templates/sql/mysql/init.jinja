-- =====================================================
-- {{ menu_title }} 菜单初始化 SQL (MySQL)
-- 自动生成于: {{ now() }}
-- =====================================================

-- 查找父级目录菜单 (path = /{{ app_name }})
SET @parent_id = (SELECT id FROM sys_menu WHERE path = '/{{ app_name }}' AND type = 0 ORDER BY id LIMIT 1);

-- 如果父级目录不存在，创建它
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
SELECT '{{ app_title }}', '{{ app_name | capitalize }}', '/{{ app_name }}', 1, 'lucide:folder', 0, 'BasicLayout', NULL, 1, 1, 1, '', '{{ app_name }}模块', NULL, NOW(), NULL
FROM DUAL WHERE @parent_id IS NULL;

-- 重新获取父级目录 ID
SET @parent_id = COALESCE(@parent_id, LAST_INSERT_ID());

-- 插入菜单
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
VALUES
('{{ menu_title }}', '{{ schema_name }}', '/{{ app_name }}/{{ table_name }}', 1, 'lucide:list', 1, '#/views/{{ app_name }}/{{ table_name }}/index.vue', NULL, 1, 1, 1, '', '{{ doc_comment }}', @parent_id, NOW(), NULL);

-- 获取刚插入的菜单 ID
SET @menu_id = LAST_INSERT_ID();

-- 新增按钮
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
VALUES
('新增', 'Add{{ schema_name }}', NULL, 1, NULL, 2, NULL, '{{ permission }}:add', 1, 0, 1, '', NULL, @menu_id, NOW(), NULL);

-- 编辑按钮
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
VALUES
('编辑', 'Edit{{ schema_name }}', NULL, 2, NULL, 2, NULL, '{{ permission }}:edit', 1, 0, 1, '', NULL, @menu_id, NOW(), NULL);

-- 删除按钮
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
VALUES
('删除', 'Delete{{ schema_name }}', NULL, 3, NULL, 2, NULL, '{{ permission }}:del', 1, 0, 1, '', NULL, @menu_id, NOW(), NULL);

-- 查看按钮
INSERT INTO sys_menu (title, name, path, sort, icon, type, component, perms, status, display, cache, link, remark, parent_id, created_time, updated_time)
VALUES
('查看', 'View{{ schema_name }}', NULL, 4, NULL, 2, NULL, '{{ permission }}:get', 1, 0, 1, '', NULL, @menu_id, NOW(), NULL);

-- =====================================================
-- 菜单生成完成
-- =====================================================
